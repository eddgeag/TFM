---
title: Integration of omics and clinical data of the hormonal, metabolic, inflammatory,
  and oxidative response in the different macronutrients of the diet
author: "Edmond Geraud"
subtitle: '`r params$subtitulo`'
date: '`r format(Sys.Date(),"%e de %B, %Y")`' 
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: true
    theme: united
    highlight: tango
header-includes:
  - \usepackage[english]{babel}
params:
  file_IP: Integromics_IPmarkers.xlsx
  file_metabolome: Integromics_Metabolome.xlsx
  file_general: Integromics_1.xlsx
  file_microbiota : integromics_microbiota.xlsx
  folder.data: ../../datos
  subtitulo: Statistical Analysis
geometry: margin=2cm
---

```{r setup, include=FALSE}
require(knitr)
# include this code chunk as-is to set options
opts_chunk$set(comment = NA, prompt = TRUE, tidy = T, 
               fig.width = 7, fig.height = 7,echo = TRUE, 
               message = FALSE, warning = FALSE, cache=TRUE)
Sys.setlocale("LC_TIME", "C")
```

## Prepare libraries.

```{r libraries}
list.of.packages <- c("xlsx","kableExtra","dplyr","ggplot2")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
res<-unlist(lapply(list.of.packages, require,character.only = T))
if(any(res==F)){
  list.of.packages[which(res==F)]
}

```


## Description of the data



### Description of the clinical data.

First of all we'll read all data.
```{r clnical_Data}
general<-file.path(params$folder.data,file=params$file_general)
general_data<-read.xlsx(general,sheetIndex = 1)
general_data.comments <- read.xlsx(general,sheetIndex = 2)
general_data.descripcion<-read.xlsx(general,sheetIndex = 3)
```

```{r process_data}
general_data$SEX <- factor(general_data$SEX,levels=c(0,2),labels = c("Female","Male"))
general_data$OBESE <- factor(general_data$OBESE,levels=c(0,1),labels = c("No Obese","Obese"))
general_data$GROUP <- factor(general_data$GROUP,levels=c(0,1,2),labels = c("Female","PCOS","Male"))
str(general_data)

```


```{r dimensiones_clinicas}
(n<-nrow(general_data))
(p<-ncol(general_data[,3:ncol(general_data)]))
```
Clinical data consists of 53 subjects. From these subjects, we have:

```{r sexo}
(sexo<-table(general_data$SEX))
```
34 females and 19 males

```{r sexo_obesos}
(sexo.obesos<-table(general_data$SEX,general_data$OBESE))
```
18 females and 10 males normal, and 9 Male obese, and 16 female obese

```{r subgrupos}
(subgrupos<-table(general_data$GROUP,general_data$OBESE))

```

From the 34 females, 9 non-obese have PCOS and 8 obese have PCOS. 


```{r barplot_subgrupos}
y <- list(grupo=subgrupos)
par(mfrow=c(1,1))
for( i in 1:length(y)){
  y.t <- y[[i]]
  barplot(y.t, xlim = c(0, ncol(y.t) + 3), col = 1:3, ylab = "Subjects", 
        legend.text = T, args.legend = list(x = ncol(y.t) + 3, 
           y = max(colSums(y.t)), bty = "n"))
  
}
```

Also we can check with a chisq-test if there are differences in the groups.

```{r}
chisq.test(subgrupos)
```
There is no relationship between categorical variables.

Regarding the numerical variables, there is an index variable, just to have in order the data. Afterwards, we have the code for the subjects. After the categorical data, there are three variables regarding the body complex and age:

1. Age
2. BMI: Body mass Index.
3. WC: Waist circumference
4. WHR: Waist to hip ratio. 

For these variables, we have the following description. The distribution of  the age of the subjects is the following

```{r}
nf <- layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,3))
par(mar=c(5.1, 4.1, 1.1, 2.1))
boxplot(general_data$EDAD, horizontal=TRUE,  outline=FALSE)
hist(general_data$EDAD,freq = F,main="Histogram of Age",xlab="")
lines(density(general_data$EDAD))
```


```{r}
with(general_data,boxplot(EDAD~GROUP))
```
Just for sanity check, we perform anova analysis on age, just to be sure that the data is equally distributed.

```{r}
shapiro.test(general_data$EDAD)
summary(with(general_data,aov(EDAD~GROUP)))
```


Regarding body complex.


```{r}
nf <- layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,3))
par(mar=c(5.1, 4.1, 1.1, 2.1))
boxplot(general_data$BMI, horizontal=TRUE,  outline=FALSE)
hist(general_data$BMI,freq = F,main="Histogram of BMI",xlab="")
lines(density(general_data$BMI))
```
Due to the fact that we have 2 groups, obese and non-obese, it is obviusly that the distribution is bimodal. 

Let's inspect by cSEX.

```{r}
with(general_data,shapiro.test(BMI))

with(general_data,boxplot(BMI~GROUP))
with(general_data,kruskal.test(BMI~GROUP))
```
We do not observe differences between control groups and PCOS.

```{r}
with(general_data,boxplot(BMI~SEX))
with(general_data,wilcox.test(BMI~SEX))
```


Also we do not observe differences between SEX and BMI, Now let's inspect by controls and PCOS.

```{r}
with(general_data,boxplot(BMI~GROUP))
with(general_data,kruskal.test(BMI~GROUP))
```



We also do not observe differences. 

```{r}
nf <- layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,3))
par(mar=c(5.1, 4.1, 1.1, 2.1))
boxplot(general_data$WC, horizontal=TRUE,  outline=FALSE)
hist(general_data$WC,freq = F,main="Histogram of Waist Circunference",xlab="")
lines(density(general_data$WC))
```

Let's inspect Waist Circunferece by GROUP.
```{r}
with(general_data,shapiro.test(WC))

with(general_data,boxplot(WC~GROUP))
with(general_data,kruskal.test(WC~GROUP))
```


Though we observe a slight difference in men, there is not statistical evidence that shows the contraire. Now let's inspect by Obese.

```{r}
with(general_data,boxplot(WC~OBESE))
with(general_data,wilcox.test(WC~OBESE))
```


Obviusly, there is a statistical difference between obese and non-obese subjects. 



```{r}
nf <- layout(mat = matrix(c(1,2),2,1, byrow=TRUE),  height = c(1,3))
par(mar=c(5.1, 4.1, 1.1, 2.1))
boxplot(general_data$WHR, horizontal=TRUE,  outline=FALSE)
hist(general_data$WHR,freq = F,main="Histogram of WHR",xlab="")
lines(density(general_data$WHR))
with(general_data,shapiro.test(WHR))
with(general_data,bartlett.test(WHR~GROUP))
with(general_data,bartlett.test(WHR~OBESE))

par(mfrow=c(1,3))
with(general_data,boxplot(WHR~GROUP))
with(general_data,boxplot(WHR~OBESE))
with(general_data,boxplot(WHR~OBESE+GROUP))

```




```{r}
with(general_data,kruskal.test(WHR~GROUP+OBESE+OBESE*GROUP))
```


```{r}
with(general_data,pairwise.wilcox.test(WHR,GROUP,method="bonferroni"))
```


```{r}
with(general_data,wilcox.test(WHR~OBESE))
```

Regarding Wist to Hip Ratio, there is a significance differece, obviusly between obese subjects.


We have 53 samples and 61 variables. The first two variables are the index of the patients, and the second column is the patient identification. Because the first column is an index we can get rid off.

In order to understand the data, we have all basal levels, but there are some in which they have only 1 day and other the mean of the three days. 


The meaning of the 61 variables are:

| Variable 	| Description 	|
|:---:	|:---:	|
| Orden 	| Order of the subjects 	|
| Paciente 	| Women contol (M),PCOS women (P),Male (V), d (Not obese), O (Obese), GLP (challenge macronutrients: glucose, lipids, proteins) 	|
|  	<br>SEX 	| 0 Women, 2 Male 	|
|  	<br>GROUP 	| 0 Women Control, 1 PCOS, 2 Male 	|
|  	<br>OBESE 	| 0 Not obese, 1 Obese 	|
| EDAD 	| Age 	|
| BMI 	| Body Mass Index 	|
| WC 	| Waist circumference 	|
| WHR 	| Waist to hip ratio 	|
| SHBG 	| Sex hormone-binding protein 	|
| TOTAL_TEST 	| Total testosterone (T) 	|
| FREE_TEST 	| Free testosterone 	|
| Total_ESTR 	| Total estradiol (E2) 	|
| Free_ESTRA 	| Free estradiol 	|
| RatioFreeTE2 	| Free T/FreeE2 ratio 	|
| hsCRP 	| High sensitivity C-reactive protein 	|
| InsulinaBasal_mean 	| Mean basal insluin 	|
| GlucosaBasal_mean 	| Mean basal glucose 	|
| SOG_ISI 	| Insulin sensitivity index (it is only calculated on the challenge oralglucose day) 	|
| HOMAIRmean 	| Homeostasis model assessment of insulin resistance (mean of the three days) 	|
| TGmean 	| Triglicerids (Basal. mean of the three challenges) 	|
| COLmean 	| Total Cholesterol (Basal. mean of the three challenges) 	|
| HDLmean 	| HDL Cholesterol (Basal. mean of the three challenges) 	|
| LDLmean 	| LDL Cholesterol (Basal. mean of the three challenges) 	|
| SOG_INS_B 	| Basal insulin when challenge oral glucose day 	|
| SOL_INS_B 	| Basal insulin when challenge oral lipid day 	|
| SOP_INS_B 	| Basal insulin when challenge oral protein day 	|
| SOG_GLC_B 	| Basal glucose when challenge oral glucose day 	|
| SOL_GLC_B 	| Basal glucose when challenge oral lipid day 	|
| SOP_GLC_B 	| Basal glucose when challenge oral protein day 	|
| SOG_HOMAIR 	| HOMAIR Glucose Oral Challenge day 	|
| SOL_HOMAIR 	| HOMAIR Lipid Oral Challenge day 	|
| SOP_HOMAIR 	| HOMAIR Protein Oral Challenge day 	|
| SOG_INS_AUC 	| Area Under the Curve of the insulin on Glucose Oral Challenge 	|
| SOL_INS_AUC 	| Area Under the Curve of the insulin on Lipids Oral Challenge 	|
| SOP_INS_AUC 	| Area Under the Curve of the insulin on Proteins Oral Challenge 	|
| SOG_GLU_AUC 	| Area Under the Curve of the Glucose on Glucose Oral Challenge 	|
| SOL_GLU_AUC 	| Area Under the Curve of the Glucose on Lipids Oral Challenge 	|
| SOP_GLU_AUC 	| Area Under the Curve of the Glucose on ProteinsOral Challenge 	|
| SOG_TG_0 	| Triglicerids at basal level on Glucose Oral Challenge 	|
| SOL_TG_0 	| Triglicerids at basal level on Lipid Oral Challenge 	|
| SOP_TG_0 	| Triglicerids at basal level on Protein Oral Challenge 	|
| SOGAUCTG 	| Triglicerids Area Under the Curve Oral Glucose Challenge 	|
| SOLAUCTG 	| Triglicerids Area Under the Curve Oral Lipids Challenge 	|
| SOPAUCTG 	| Triglicerids Area Under the Curve Oral Proteins Challenge 	|
| SOG_COL_0 	| Cholesterol at basal level on Glucose Oral Challenge 	|
| SOL_COL_0 	| Cholesterol basal level on Lipid Oral Challenge 	|
| SOP_COL_0 	| Cholesterol at basal level on Protein Oral Challenge 	|
| SOGAUCCOL 	| Cholesterol Area Under the Curve Oral Glucose Challenge 	|
| SOLAUCCOL 	| Cholesterol Area Under the Curve Oral Lipids Challenge 	|
| SOPAUCCOL 	| HDL Cholesterol Area Under the Curve Oral Proteins Challenge 	|
| SOG_HDL_0 	| HDL Cholesterol at basal level on Glucose Oral Challenge 	|
| SOL_HDL_0 	| HDL Cholesterol basal level on Lipid Oral Challenge 	|
| SOP_HDL_0 	| HDL Cholesterol at basal level on Protein Oral Challenge 	|
| SOGAUCHDL 	| HDLCholesterol Area Under the Curve Oral Glucose Challenge 	|
| SOLAUCHDL 	| HDL Cholesterol Area Under the Curve Oral Lipids Challenge 	|
| SOPAUCHDL 	| HDL Cholesterol Area Under the Curve Oral Proteins Challenge 	|
| SOG_LDL_0 	| LDL Cholesterol at basal level on Glucose Oral Challenge 	|
| SOL_LDL_0 	| LDL Cholesterol basal level on Lipid Oral Challenge 	|
| SOP_LDL_0 	| LDL Cholesterol at basal level on Protein Oral Challenge 	|
| SOGAUCLDL 	| LDL Cholesterol Area Under the Curve Oral Glucose Challenge 	|
| SOLAUCLDL 	| LDL Cholesterol Area Under the Curve Oral Lipids Challenge 	|
| SOPAUCLDL 	| LDL Cholesterol Area Under the Curve Oral Proteins Challenge 	|


In general SOG means Glucose Oral Challenge, SOL: Lipid Oral challenge, and SOP Protein Oral challenge.

It has to be mentioned that SOG and SOP challenges were takes at 3 times: 0, 60 and 120 min. But SOL, the times differ: 0,120,240, because the absortion of lipids by the intestine is slower. 





## Univariate statistical analysis

### Clinical data 

First of all let's observe the structure of the data and a sample of it. Also let's observe is there any missingvalues. But first of all an extract of the data. 


```{r structureClinicalData}
str(general_data)
```

At first sight, we have 3 factor variables, sex, group, and obese. Furthermore we have the samples names and the order. The other variables are numeric. Thus let's convert into factor those categorical variables


```{r}
general_data.variables <- general_data[,3:ncol(general_data)]

resumen<-function(x){c(min(x),quantile(x,0.25),quantile(x,0.5),mean(x),quantile(x,0.75),max(x),sd(x))}

general_data.sum<-general_data.variables %>%group_by(GROUP,OBESE) %>%
  summarise(across(where(is.numeric),resumen),n=n())


```


```{r}
with(general_data.variables,table(GROUP,OBESE))
```


```{r}
histdens_clinical<-function(datos){
  
  p<-4:ncol(datos)
  gr<-(ceiling(sqrt(length(p))))
  par(mfrow=c(4,4))
  for ( i in p){
    
    hist(datos[,i],freq=F,main = "",xlab =colnames(datos)[i],ylab = "Density",col="lightblue" )
    lines(density(datos[,i]),col="navy")
    
    
  }

}

both<-union(levels(general_data.variables$GROUP),levels(general_data.variables$GROUP))
with(general_data.variables,boxplot(EDAD~OBESE:GROUP))
```


```{r}
histdens_clinical(general_data.variables)

```


